{"version":3,"sources":["../src/context.js"],"names":["IGNORED_FILES_CONFIG_PATH","path","join","process","cwd","DEFAULT_WWW_FOLDER","DEFAULT_CLI_CONFIG","DEFAULT_IGNORE_LIST","exports","context","chcpContext","argv","Context","defaultConfig","sourceDirectory","getSourceDirectory","manifestFilePath","projectsConfigFilePath","ignoredFiles","getIgnoredFiles","consoleArgs","_","length","projectIgnore","readIgnoredFilesProjectConfig","ignoredList","union","remove","item","indexOf","trim","pathToConfig","fileContent","fs","readFileSync","e","split"],"mappings":";;;;;;;;AAAA;;AACA;;AACA;;;;;;;;AAEA,MAAMA,yBAAyB,GAAGC,cAAKC,IAAL,CAAUC,OAAO,CAACC,GAAR,EAAV,EAAyB,aAAzB,CAAlC;;AACA,MAAMC,kBAAkB,GAAGJ,cAAKC,IAAL,CAAUC,OAAO,CAACC,GAAR,EAAV,EAAyB,KAAzB,CAA3B;;AACA,MAAME,kBAAkB,GAAGL,cAAKC,IAAL,CAAUC,OAAO,CAACC,GAAR,EAAV,EAAyB,kBAAzB,CAA3B;;AAEA,MAAMG,mBAAmB,GAAG,CACxB,WADwB,EAExB,iBAFwB,EAGxB,kBAHwB,EAIxB,cAJwB,EAKxB,kBALwB,EAMxB,QANwB,EAOxB,YAPwB,EAQxB,UARwB,EASxB,MATwB,EAUxB,cAVwB,CAA5B;;AAaAC,OAAO,CAACC,OAAR,GAAkB,SAASC,WAAT,CAAqBC,IAArB,EAA2B;AACzC,SAAO,IAAIC,OAAJ,CAAYD,IAAZ,CAAP;AACH,CAFD;;AAIA,MAAMC,OAAO,GAAG,SAAVA,OAAU,CAAUD,IAAV,EAAgB;AAC5B,OAAKA,IAAL,GAAYA,IAAI,GAAGA,IAAH,GAAU,EAA1B;AACA,OAAKE,aAAL,GAAqBP,kBAArB;AACA,OAAKQ,eAAL,GAAuBC,kBAAkB,CAACJ,IAAD,CAAzC;AACA,OAAKK,gBAAL,GAAwBf,cAAKC,IAAL,CAAU,KAAKY,eAAf,EAAgC,eAAhC,CAAxB;AACA,OAAKG,sBAAL,GAA8BhB,cAAKC,IAAL,CAAU,KAAKY,eAAf,EAAgC,WAAhC,CAA9B;AACA,OAAKI,YAAL,GAAoBC,eAAe,EAAnC;AACH,CAPD;;AASA,SAASJ,kBAAT,CAA4BJ,IAA5B,EAAkC;AAC9B,MAAIS,WAAW,GAAGT,IAAI,CAACU,CAAvB;;AACA,MAAI,CAACD,WAAD,IAAgBA,WAAW,CAACE,MAAZ,KAAuB,CAA3C,EAA8C;AAC1C,WAAOjB,kBAAP;AACH;;AAED,SAAOJ,cAAKC,IAAL,CAAUC,OAAO,CAACC,GAAR,EAAV,EAAyBgB,WAAW,CAAC,CAAD,CAApC,CAAP;AACH;;AAED,SAASD,eAAT,GAA2B;AACvB,MAAII,aAAa,GAAGC,6BAA6B,CAC7CxB,yBAD6C,CAAjD;;AAGA,MAAIyB,WAAW,GAAGJ,CAAC,CAACK,KAAF,CAAQnB,mBAAR,EAA6BgB,aAA7B,CAAlB,CAJuB,CAMvB;;;AACAF,EAAAA,CAAC,CAACM,MAAF,CAASF,WAAT,EAAsB,UAAUG,IAAV,EAAgB;AAClC,WAAOA,IAAI,CAACC,OAAL,CAAa,GAAb,MAAsB,CAAtB,IAA2BR,CAAC,CAACS,IAAF,CAAOF,IAAP,EAAaN,MAAb,KAAwB,CAA1D;AACH,GAFD;;AAIA,SAAOG,WAAP;AACH;;AAED,SAASD,6BAAT,CAAuCO,YAAvC,EAAqD;AACjD,MAAIC,WAAJ;;AACA,MAAI;AACAA,IAAAA,WAAW,GAAGC,iBAAGC,YAAH,CAAgBH,YAAhB,EAA8B,MAA9B,CAAd;AACH,GAFD,CAEE,OAAOI,CAAP,EAAU;AACR,WAAO,EAAP;AACH;;AAED,SAAOd,CAAC,CAACS,IAAF,CAAOE,WAAP,EAAoBI,KAApB,CAA0B,IAA1B,CAAP;AACH","sourcesContent":["import path from 'path';\r\nimport fs from 'fs-extra';\r\nimport * as _ from 'lodash';\r\n\r\nconst IGNORED_FILES_CONFIG_PATH = path.join(process.cwd(), '.chcpignore');\r\nconst DEFAULT_WWW_FOLDER = path.join(process.cwd(), 'www');\r\nconst DEFAULT_CLI_CONFIG = path.join(process.cwd(), 'cordova-hcp.json');\r\n\r\nconst DEFAULT_IGNORE_LIST = [\r\n    '.DS_Store',\r\n    'node_modules/**',\r\n    'node_modules\\\\**',\r\n    '**/chcp.json',\r\n    '**/chcp.manifest',\r\n    '.chcp*',\r\n    '.gitignore',\r\n    '.gitkeep',\r\n    '.git',\r\n    'package.json',\r\n];\r\n\r\nexports.context = function chcpContext(argv) {\r\n    return new Context(argv);\r\n};\r\n\r\nconst Context = function (argv) {\r\n    this.argv = argv ? argv : {};\r\n    this.defaultConfig = DEFAULT_CLI_CONFIG;\r\n    this.sourceDirectory = getSourceDirectory(argv);\r\n    this.manifestFilePath = path.join(this.sourceDirectory, 'chcp.manifest');\r\n    this.projectsConfigFilePath = path.join(this.sourceDirectory, 'chcp.json');\r\n    this.ignoredFiles = getIgnoredFiles();\r\n};\r\n\r\nfunction getSourceDirectory(argv) {\r\n    var consoleArgs = argv._;\r\n    if (!consoleArgs || consoleArgs.length !== 2) {\r\n        return DEFAULT_WWW_FOLDER;\r\n    }\r\n\r\n    return path.join(process.cwd(), consoleArgs[1]);\r\n}\r\n\r\nfunction getIgnoredFiles() {\r\n    var projectIgnore = readIgnoredFilesProjectConfig(\r\n        IGNORED_FILES_CONFIG_PATH\r\n    );\r\n    var ignoredList = _.union(DEFAULT_IGNORE_LIST, projectIgnore);\r\n\r\n    // remove comments and empty items\r\n    _.remove(ignoredList, function (item) {\r\n        return item.indexOf('#') === 0 || _.trim(item).length === 0;\r\n    });\r\n\r\n    return ignoredList;\r\n}\r\n\r\nfunction readIgnoredFilesProjectConfig(pathToConfig) {\r\n    var fileContent;\r\n    try {\r\n        fileContent = fs.readFileSync(pathToConfig, 'utf8');\r\n    } catch (e) {\r\n        return [];\r\n    }\r\n\r\n    return _.trim(fileContent).split(/\\n/);\r\n}\r\n"],"file":"context.js"}